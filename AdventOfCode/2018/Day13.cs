using System;
using System.Collections.Generic;
using System.Linq;

namespace AdventOfCode._2018
{
    internal class Day13
    {
        private enum Dir
        {
            NORTH,
            EAST,
            SOUTH,
            WEST
        }

        private enum Turn
        {
            LEFT,
            STRAIGHT,
            RIGHT
        }

        public void Solve()
        {
            var lines = input.Split(Environment.NewLine);
            var grid = new char[lines.Length][];
            var carts = new List<(int X, int Y, Dir direction, Turn turn, bool deleted)>();
            for (int i = 0; i < lines.Length; i++)
            {
                grid[i] = new char[lines[i].Length];
                for (int j = 0; j < lines[i].Length; j++)
                {
                    var curChar = lines[i][j];
                    grid[i][j] = curChar;
                    // detect cart
                    if (curChar == '^' || curChar == 'v')
                    {
                        grid[i][j] = '|';
                        carts.Add((i, j, curChar == '^' ? Dir.NORTH : Dir.SOUTH, Turn.LEFT, false));
                    }
                    if (curChar == '>' || curChar == '<')
                    {
                        grid[i][j] = '-';
                        carts.Add((i, j, curChar == '>' ? Dir.EAST : Dir.WEST, Turn.LEFT, false));
                    }
                }
            }

            // print function
            //Console.WriteLine("- start condition");
            //var printGrid = new char[grid.Length][];
            //for (int i = 0; i < printGrid.Length; i++) { printGrid[i] = new string(grid[i]).ToCharArray(); }
            //for (int i = 0; i < carts.Count; i++) { var cart = carts[i]; if (cart.deleted) { continue; } printGrid[cart.X][cart.Y] = '*'; }
            //for (int i = 0; i < printGrid.Length; i++) { Console.WriteLine($"{i}" + new string(printGrid[i])); }
            //Console.WriteLine("-");
            Console.WriteLine($"Total carts found: {carts.Count}");

            // roll out the carts
            bool last = false;
            bool firstCrash = false;
            var coordinates = new HashSet<(int, int)>();
            int iteration = 1;
            while (!last)
            {
                var coordinatesToDelete = new List<(int X, int Y)>();
                var startingCoordinates = carts.Where(t => !t.deleted).Select(t => (t.X, t.Y)).ToList();
                coordinates = new HashSet<(int, int)>();

                carts = carts.OrderBy(c => c.X).ToList() ;

                // part02
                if (carts.Count(t => !t.deleted) == 1)
                {
                    var lastCart = carts.Where(t => !t.deleted).First();
                    Console.WriteLine($"Last cart starts at: ({lastCart.Y},{lastCart.X}) at iteration: {iteration}");
                    // not 70,82
                    last = true;
                    break;
                }

                // loop through the list of carts and update the coordinates
                for (int i = 0; i < carts.Count; i++)
                {
                    var cartCopy = carts[i];
                    var cart = carts[i];
                    if (cart.deleted) { continue; } // ignore deleted carts

                    var gridPiece = grid[cart.X][cart.Y];
                    var going = cart.direction;
                    // Go Straight - nothing changes .. dont even do this
                    // if (gridPiece == '|') { cart.Y += cart.direction == Dir.NORTH ? -1 : 1; }
                    // if (gridPiece == '-') { cart.X += cart.direction == Dir.WEST ? -1 : 1; }

                    // Turn Corner
                    if (gridPiece == '/')
                    {
                        if (going == Dir.EAST || going == Dir.WEST) { cart.direction = going == Dir.EAST ? Dir.NORTH : Dir.SOUTH; }
                        else { cart.direction = going == Dir.SOUTH ? Dir.WEST : Dir.EAST; }
                    }
                    if (gridPiece == '\\')
                    {
                        if (going == Dir.EAST || going == Dir.WEST) { cart.direction = going == Dir.WEST ? Dir.NORTH : Dir.SOUTH; }
                        else { cart.direction = going == Dir.NORTH ? Dir.WEST : Dir.EAST; }
                    }

                    // Junction
                    if (gridPiece == '+')
                    {
                        bool cartChanged = false;
                        if (!cartChanged && cart.turn == Turn.STRAIGHT) { cart.turn = Turn.RIGHT; cartChanged = true; }
                        if (!cartChanged && cart.turn == Turn.LEFT)
                        {
                            if (going == Dir.NORTH) { cart.direction = Dir.WEST; }
                            if (going == Dir.EAST) { cart.direction = Dir.NORTH; }
                            if (going == Dir.SOUTH) { cart.direction = Dir.EAST; }
                            if (going == Dir.WEST) { cart.direction = Dir.SOUTH; }
                            cart.turn = Turn.STRAIGHT;
                            cartChanged = true;
                        }
                        if (!cartChanged && cart.turn == Turn.RIGHT)
                        {
                            if (going == Dir.NORTH) { cart.direction = Dir.EAST; }
                            if (going == Dir.EAST) { cart.direction = Dir.SOUTH; }
                            if (going == Dir.SOUTH) { cart.direction = Dir.WEST; }
                            if (going == Dir.WEST) { cart.direction = Dir.NORTH; }
                            cart.turn = Turn.LEFT;
                            cartChanged = true;
                        }
                    }

                    // UPDATE COORDINATES
                    if (cart.direction == Dir.NORTH || cart.direction == Dir.SOUTH) { cart.X += cart.direction == Dir.NORTH ? -1 : 1; }
                    if (cart.direction == Dir.WEST || cart.direction == Dir.EAST) { cart.Y += cart.direction == Dir.WEST ? -1 : 1; }

                    // collision check, they are like -->-<-- or --><--
                    if (coordinates.Contains((cart.X, cart.Y)) || startingCoordinates.Contains((cart.X, cart.Y)))
                    {
                        if (!firstCrash)
                        {
                            Console.WriteLine($"Day13 part1 answer CRASHED at ({cart.Y},{cart.X}) on iteration {iteration}");
                        }
                        Console.WriteLine($"Removed carts on position ({cart.Y},{cart.X}) on iteration {iteration}");
                        firstCrash = true;
                        cart.deleted = true;

                        // delete the original coordinates from cart from the starting position list
                        startingCoordinates.Remove((cartCopy.X, cartCopy.Y));

                        // insert right away
                        carts[i] = cart;
                        // collides with an already moved cart, type -->-<--

                        int indexMovedCart = carts.FindIndex(t => t.X == cart.X && t.Y == cart.Y && !t.deleted);
                        var movedCart = carts[indexMovedCart];
                        movedCart.deleted = true;
                        carts[indexMovedCart] = movedCart;

                        // remove the to be collision
                        if (coordinates.Contains((cart.X, cart.Y)))
                        {
                            coordinates.Remove((cart.X, cart.Y));
                        }
                        else
                        {
                            // collision with non moved cart, type --><--
                            startingCoordinates.Remove((cart.X, cart.Y));
                        }
                    }
                    else
                    {
                        coordinates.Add((cart.X, cart.Y));
                        startingCoordinates.Remove((cartCopy.X, cartCopy.Y));
                    }

                    // UPDATE CARTS!
                    // update this cart in the list
                    carts[i] = cart;

                    // something wrong -- insane debugging
                    if (cart.X < 0 || cart.X >= grid.Length || cart.Y < 0 || cart.Y >= grid[0].Length)
                    {
                        //Console.WriteLine($"SOMETING TERRIBLE, i am going off the rails at ({cart.X},{cart.Y}) and came from ({cartCopy.X},{cartCopy.Y} ) - Gridsize: {grid.Length} x {grid[0].Length}");
                    }
                    if (grid[cart.X][cart.Y] == ' ')
                    {
                        Console.WriteLine($"I am parked on a empty square.. LOL ({cart.X},{cart.Y}) and came from ({cartCopy.X},{cartCopy.Y} ) - Gridsize: {grid.Length} x {grid[0].Length}");
                    }
                }

                // print function after each iteration
                // var printGrid = new char[grid.Length][];
                //for (int i = 0; i < printGrid.Length; i++) { printGrid[i] = new string(grid[i]).ToCharArray(); }
                //for (int i = 0; i < carts.Count; i++) { var cart = carts[i]; if (cart.deleted) { continue; } printGrid[cart.X][cart.Y] = '*'; }
                //for (int i = 0; i < printGrid.Length; i++) { Console.WriteLine($"{i}" + new string(printGrid[i])); }
                //Console.WriteLine("-");
                iteration++;
            }
        }

        public string testinput2 = @"|
v
|
|
|
^
|";

        public string testinput4 = @"/>----\
|>>-+<|
\->>+</";

        public string testinput = @"/-><\  
|   |  
| /<+-\
| v | |
\>+</ v
  ^   ^
  \<->/ ";

        public string testinput3 = @"/->-\
|   |  /----\
| /-+--+-\  |
| | |  | v  |
\-+-/  \-+--/
  \------/   ";

        public string input = @"                      /---------\                                                             /-------------------------------\
                    /-+---------+------------------------------\                              |                               |
                    | |         |/-----------------------------+------------------------------+-------------------------------+--------------\
                    | |         ||    /------------------------+------------------------------+-\                             |              |
                    | |         ||    |     /------------------+------------------------------+-+-----------------------------+------------\ |
              /-----+-+---------++----+-----+------------------+------------------------------+-+\                         /--+------------+-+------\
              |     | |         ||/---+-----+------------------+------------------------------+-++-------------------------+--+-\          | |      |
    /---------+-----+-+---------+++---+-----+------\           |                              | ||                         |  | |          | |      |
    |         |     | |    /----+++---+-----+------+-----------+------------------------------+-++-------------------------+--+-+\         | |      |
    |         |     | |    |    ||| /-+-----+------+-----------+---------------\          /---+-++-------------------------+--+-++---\     | |      |
    |       /-+-----+-+----+----+++-+-+-----+------+-----------+---------\     |          |   | ||                         |  | ||   |     | |      |
    |       | |     | |    |    ||| | |     |      |           |      /--+-----+----------+---+-++-------------------------+--+-++---+-----+-+--\   |
    |       | | /---+-+----+----+++-+-+-----+------+-----------+------+--+-----+----------+\  | ||        /----------------+--+\||   |     | |  |   |
    |       | | |   | |    |    ||| | |     |      |           |      |  |     |          ||  | ||        |                |  ||||   |     | |  |   |
    |       | | |   | |    |    ||| | |     |      |           |    /-+--+-----+----------++--+-++---\    |                |  ||||   |     | |  |   |
    |       | | |   | |    |    ||| | |     |      |           |/---+-+--+-----+----------++--+-++---+----+-------\        \--++++---+-----+-+--+---/
   /+-------+-+-+---+-+----+----+++\| |     |      |          /++---+-+--+-----+----------++--+-++---+----+-------+-----------++++--\|     | |  |
  /++-------+-+-+---+-+----+----+++++-+-----+------+----------+++-\ | |  |     |          ||  | ||   |    |       |           ||||  ||     | |  |
  |||       | | | /-+-+----+----+++++-+-----+------+----------+++-+-+-+-\|     |          ||  | ||   |    |       |           ||||  ||     | |  |
  |||       | | | | ^ |    |    ||||| |     |      |    /-----+++-+-+-+-++\    |/---------++--+-++---+----+-------+-----------++++--++----\| |  |
  |||       | | | | | |    |    ||||| |     |      |    |     ||| | | | |||    ||         ||  | ||   |    |       |/----------++++--++-\  || ^  |
  |||       | | | | \-+----+----+++++-+-----+------+----+-----+/| | | | |||    ||  /------++--+-++\  |    |       ||          ||||  || |  || |  |
  |||     /-+-+-+-+---+--\ |    ||||| |     |      |    |     | | | | | |||    ||  |    /-++--+-+++--+----+-------++----------++++--++-+--++-+--+----\
  |||     | | | | |   |  | |    ||||| |     |      | /--+-----+-+-+-+-+-+++----++--+----+-++--+-+++--+----+-------++----------++++--++-+--++-+--+--\ |
  |||     | | | | |   |/-+-+----+++++-+-----+------+-+--+----\| | | | | |||    ||  |    | || /+-+++--+----+--\    ||          ||||  || |  || |  |  | |
  |||     | | | | |  /++-+-+----+++++-+-----+------+-+--+----++-+-+-+-+-+++----++--+----+-++-++-+++--+---\|  |    ||          ||||  || |  || |  |  | |
  |||     | | | | |  ||| | |    ||||| |     |      | |  |    || | | | \-+++----++--+----+-++-++-+++--+---++--+----++----------++++--++-+--++-+--/  | |
  |||     | | | | |  ||| | |    ||||| |  /--+------+-+--+----++-+-+-+---+++----++--+----+-++-++-+++--+---++--+----++----------++++--++-+\ || |     | |
  |||     | | | | |  ||| | |    ||||| |/-+--+------+-+--+----++-+-+-+---+++----++--+----+-++\|| |||  |   ||  |    ||          ||||  || || || |     | |
/-+++-----+-+-+-+-+--+++-+-+----+++++-++-+--+------+-+--+----++-+-+-+---+++----++--+--\ | ||||| |||  |   ||  |    ||          ||||  || || || |     | |
| |||     v | | | |  ||| | |    ||||| || |  |      | |  |    || |/+-+---+++----++--+--+-+-+++++-+++-\|   ||  |    ||          ||||  || || || |     | |
| |||     | | | | |  ||| | |    ||||| || |  |      | |  |    || ||| |   |||    ||  |  | | \++++-+++-++---++--+----++----------++++--+/ || || |     | |
| |\+-----+-+-+-+-+--+++-+-+----+++/| || |  |      | |  |    ||/+++-+---+++----++--+--+-+--++++-+++-++---++--+----++----------++++--+--++-++-+-----+\|
| | |     | | | | |  ||| | |    ||| | || |  |   /--+-+--+----++++++-+---+++----++--+--+-+--++++-+++-++---++--+----++\         ||||  |  || || |     |||
| | |     | | | | |  ||| | |    ||| | || |  |/--+--+-+--+----++++++-+---+++----++--+--+-+--++++-+++-++---++--+----+++--\      ||||  |  || || |     |||
| | |     | | | | |  ||| | |    ||\-+-++-+--++--+--+-+--+----++++++-+---+++----++--+--+-+--++++-+++-++---++--+----+++--+------++/|  |  || || |     |||
| | |     |/+-+-+-+--+++-+-+----++--+-++-+-\||  |  | |  |    |||||| |   |||    ||  |  | |  |||| ||| ||   ||  |    |||  |      || |  |  || || |     |||
| | |     ||| | | |  ||| | |    ||  | || | |||  |  | |  |/---++++++-+---+++----++--+--+-+--++++-+++-++---++--+----+++--+------++-+--+--++<++-+--\  |||
| | |     ||| | | |  ||| | |    ||  | || | |||  |  | |  ||   |||||| |   |||    ||  |  | |  |||| ||| ||   ||  |    |||  |      || |  |  || || |  |  |||
| | |     ||| | | |  ||| | |    ||  | || | ||| /+--+-+--++---++++++\|   |||   /++--+--+-+--++++\||| ||   ||  |    |||  |      || |  |  || || |  |  |||
| | |     ||| | | |  ||| | |    ||  | ||/+-+++-++--+-+--++---++++++++---+++---+++--+--+-+--++++++++-++---++--+\   |||  |      || |  |  || || |  |  |||
| | |     ||| | | |  ||| |/+----++--+-++++-+++-++--+-+--++---++++++++---+++---+++\ |  | |  |||||||| ||   ||  ||  /+++--+--\   || |  |  || || |  |  |||
| | |    /+++-+-+-+--+++-+++----++--+-++++-+++-++--+\|  ||   ||||||||   |||   |||| |  | |  |||||||| || /-++--++--++++--+--+---++-+--+\ || || |  |  |||
| | |    |||| | \-+--+++-+++----++--+-++++-+++-++--+++--++---++++++++---+++---++++-+--+-+--/||||||| || | ||  ||  ||||  |  |   || |  || || || |  |  |||
| | |    |||| |   |  ||| |||    ||  | |||| ||| ||  |||  ||   ||||||||   |||   |||| |  | |   ||||||| || | ||  ||  ||||  |  |   || |  || || || |  |  |||
\-+-+----++++-+---+--+++-+++----++--+-++++-+++-++--+++--++---++++++++---+++---++++-+--/ |   ||||||| || | ||  ||  ||||  |  |   || |  || || || |  |  |||
  | |    |||| |   |  ||| |||    |\--+-++++-+++-++--+++--++---++++++++---+++---++++-+----+---+++++++-++-+-++--++--++++--+--+---++-+--++-++-++-/  |  |||
  | |    |||| |   |  ||| |||    |  /+-++++-+++-++--+++--++---++++++++---+++---++++-+----+---+++++++-++-+-++--++--++++--+--+---++-+-\|| || ||    |  |||
  | |    |||| |   |  ||| |||    |  || |||| ||| ||  |||  ||   ||||||||   |||   |||| |/---+---+++++++-++-+-++--++--++++--+--+-\ || | ||| || ||    |  |||
  | |  /-++++-+--\|  ||| |||    |  || |||| ||| \+--+++--++---++++++/|   ||| /-++++-++---+---+++++++-++-+-++--++--++++--+--+-+-++-+-+++-++-++---\|  |||
  | |  | |||| |  ||  ||| |||    |  || |||| |||  |  |||  ||   |||||| |  /+++-+-++++-++---+---+++++++-++-+-++--++--++++--+--+-+-++-+-+++-++-++--\||  |||
  | |  | |||| | /++--+++-+++----+--++-++++-+++--+--+++--++---++++++-+--++++-+-++++-++---+---+++++++-++-+-++--++\ ||||  |  | | || | ||| || ||  |||  |||
  | |  | ||||/+-+++--+++-+++----+--++-++++-+++--+--+++--++---++++++\|  |||| | |||| || /-+---+++++++-++\| ||  ||| ||||  |  | | || | ||| || ||  |||  |||
  | |  | |||||| |||  ||| |||    |  || |||| |||  |  |||/-++---++++++++--++++-+-++++-++\| |   ||||||| |||| ||  ||| ||||  |  | | || | ||| || ||  |||  |||
  | |  | |||||| |||  ||| |||    |  || |||| |\+--+--++++-++---++++++++--++++-+-++++-++++-+---+++++++-++++-++--+++-++++--+--+-+-++-+-+++-++-+/  |||  |||
  \-+--+-++++++-+++--+++-+++----+--++-++++-+-+--+--++++-++---+++++/||  |||| | \+++-++++-+---+++/||| |||| ||  ||| ||||  |  | | || | ||| || |   |||  |||
    |  | |||||| |||  ||| |||    |  || |||| | |  |  ||||/++---+++++-++--++++-+--+++-++++-+---+++-+++-++++-++--+++-++++--+--+-+-++\| ||| || |   |||  |||
    |  | |||||| |||  ||| |||    |  || |||| | |  |  |||||||   ||||| ||  |||| |  ||| |||| |   ||| ||| |||| ||  ||| ||||  |  | | |||| ||| || |   |||  |||
    |  | |||||| |||  |||/+++----+--++-++++-+-+--+--+++++++---+++++-++--++++-+--+++-++++-+---+++\||| |||| ||  |||/++++--+--+-+-++++-+++-++-+---+++\ |||
    |  | |||||| |||  |||||||    |  || |||| | |  |  |||||||   ||||| ||  |||| |  ||| |||| |   ||||||| |||| ||  ||||||||  |  | | |||| ||| || |   |||| |||
    |  | |\++++-+++--++++/||    |  || |||| | |  | /+++++++---+++++-++--++++-+--+++-++++-+---+++++++-++++-++--++++++++\ |  | | |||| ||| || |   |||| |||
    |  | | |||| |||  |||| ||    |  || |||| | |  | ||||||||   ||||| ||  |||| |  ||| |||| |   ||||||| |||| ||/-+++++++++-+--+-+-++++-+++-++-+-\ ||^| |||
    |  | | |||| \++--++++-++----+--++-++++-+-+--+-++++++++---+++++-++--++++-+--+++-++++>+---+++++++-++++-+++-++/|||||| |  | | |||| ||| || | | |||| |||
 /--+--+-+-++++--++-\|||| ||    |  || |||| | |  | ||||||||   ||||| ||  |||| |  ||| |||| |   ||||||| |||| ||| || |||||| |  | | |||| ||| || | | |||| |||
 |  |  | | ||||  ^| ||||| ||    |  ||/++++-+-+--+-++++++++---+++++-++-\|||| |  ||| |||| |   |||||||/++++-+++-++-++++++-+--+-+-++++-+++-++-+-+\|||| |||
 |  |  | | ||||  || ||||| ||    |  ||||||| | |  | ||||||||   ||||| |\-+++++-+--+++-++++-+---+++++++++/|| ||| || |||||| |  | | |||| ||| || | |||||| |||
 |  |  | | ||||  || ||||| ||    |  ||||||| | |  | |||||||\---+++++-+--+++++-+--+++-++++-+---+++++++++-++-+++-++-++++++-+--+-+-++++-+++-++-+-++++/| |||
 |  |  | | ||||  || ||||| ||    |  ||||||| | |  | |||||||    ||||| |  ||||| |  ||| |||| |   ||||||||| || ||| || |||||| |  | | |||| ||| || | |||| | |||
 |  |  | | v|||  |\-+++++-++----+--+++++++-+-+--+-+++++++----+++++-+--++/|| \--+++-++++-+---+++++++++-++-+++-++-++++++-+--+-+-++++-+++-++-+-+++/ | |||
 |  |  | | ||||  |  ||||| ||    |  ||||||| | | /+-+++++++----+++++-+--++-++----+++-++++-+---+++++++++-++-+++-++-++++++-+--+-+-++++-+++-++-+-+++--+\|||
 |  | /+-+-++++--+-\||||| ||    |  ||||||| | | ||/+++++++----+++++-+--++-++----+++-++++-+---+++++++++-++-+++-++-++++++\|  | | |||| ||| || | |||  |||||
 |  | || | ||||  | |||||| || /--+--+++++++-+-+-++++++++++----+++++-+--++-++----+++-++++-+--\||||||||| || ||| || ||||||||  | | |||| ||| || | |||  |||||
 |  | || | \+++--+-++++++-++-+--+--+++++++-/ | ||||||||||    |||||/+--++-++----+++-++++-+--++++++++++-++-+++-++-++++++++\/+-+-++++-+++-++-+\|||  |||||
 |  | || |  \++--+-++++++-++-+--+--+++++++---+-++++++++++----+++++++--++-/|    ||| |||| |  |||||||||| || ||| || ||||||||||| | |||| ||| || |||||  |||||
 |  v || |   ||  | |||||| || |  |  |||||||   | ||||||||||    ||\++++--++--+----+++>++++-+--++++++++++-++-+++-++-+++++++++++-+-++++-+++-++-+++++--+++/|
 |  | ||/+---++--+-++++++-++-+--+--+++++++---+-++++++++++----++-++++--++--+----+++-++++-+\ |||||||||| || ||| || ||||||||||| | |||| ||| || |||||  ||| |
 |  | ||||   ||  | ||||\+-++-+--+--+++++++---+-++++++++++----/| ||||  ||  |    ||| ||||/++-++++++++++-++-+++-++-+++++++++++\| |||| ||| || |||||  ||| |
 |  | ||||   ||  | |||| | || |  |  |||||||   | ||||||||||     | ||||/-++--+----+++-+++++++-++++++++++\|| ||| || ||||||||||||| |||| ||| || |||||  ||| |
 |  | ||||   || /+-++++-+-++-+--+--+++++++---+-++++++++++-----+-+++++-++\ |    ||| ||||||| ||||||||||||| ||| || ||||||||||||| |||| ||| || |||||  ||| |
 |  | ||||   || || |||| | || |  |  |||||||   | ||||||||||     | ||||| ||| |    ||| ||||||| ||\++++++++++-+++-/| ||||||||||||| |||| ||| || |||||  ||| |
 |  | ||||   || || |||| | || |  |  |||||||   | ||||||||||     | ||||| |||/+----+++-+++++++-++-++++++++++-+++--+-+++++++++++++-++++-+++\|| |||||  ||| |
 |  | ||||   || || |||| | || |  |  |||||||/--+-++++++++++-----+-+++++-+++++----+++-+++++++-++-++++++++++-+++\ | ||||||||||||| |||| |||||| |||||  ||| |
 |  | ||||   \+-++-++++-+-++-+--+--++++++++--+-++++++++++-----+-+++/| |||||    ||| ||||||| || |||||||||| |||| | ||||||||||||| |||| |||||| |||||  ||| |
 |  | ||||    | || |||| | || |  |  |\++++++--+-++++++++++-----+-+++-+-+++++----/|| ||||||| || \+++++++++-++++-+-+++++++++++++-/||| |||||| |||||  ||| |
 |  | ||||    | || |||| | || |  |  | ||||||  | ||||||||||     | ||| | |\+++-----++-+++++++-++--+++++++++-++++-+-+++++++++++++--+++-++++++-++++/  ||| |
 |  | ||||    | || |||| | || |  |  | ||||||  | |||||||||\-----+-+++-+-+-++/     || ||||||| ||  |||||||||/++++-+-+++++++++++++\ ||| |||||| ||||   ||| |
 |  | ||||    | || |||| | || |  |  | ||||||  | |||||||||      | ||| | | ||      || ||||||| ||  |||||||||||||| | |||||||||||||| ||| |||||| ||||   ||| |
 |  | ||||    | || |||| | || |  |  | ||||||  | |||||||||      | ||| |/+-++-----\|| ||||||| ||  |||||||||||||| | |||||||||||||| ||| |||||| ||||   ||| |
 |  | |||| /--+-++-++++-+-++-+--+--+\||||||  | |||||||||      | ||| ||| ||     ||| ||||||| v|  |||||||||||||| | |||\++++++++++-+++-++++/| ||||   ||| |
 |  | |||| |  | \+-++++-+-++-+--+--++++++++--+-+++++++++------+-+++-+++-/|     ||| ||||||| ||  ||||||||||||||/+-+++-++++++++++-+++-++++-+-++++--\||| |
 |  | |||| |  |  | |||| | || |  |  |||\++++--+-+++++++++------+-+++-+++--+-----+++-+++++++-++--+/|||||||||||||| ||| ||||||||||/+++-++++-+-++++-\|||| |
 |  | |||| |  |  | |||\-+-++-+--/  ||| |||\--+-+++++++++------+-+++-+++--+-----+++-+++++++-++--+-+++++++++++/|| |\+-++++++/||||||| |||| | |||| ||||| |
 |  | |||| |  |  | |||  | || |     ||| |||   | |||||||||      | |\+-+++--+-----+++-+++++++-++--+-+++/||||||| || | | |||||| ||||||| |||| | |||| ||||| |
 |/-+-++++-+-\|  | |||  | || |     ||| |||   | |||||||||      | | | |||  |     ||| ||||||| ||  | ||| ||||||| || | | |||||| ||||||| |||| | |||| ||||| |
 || | |||| | ||  | |||  | || |     ||| |||   | |||||||\+------+-+-+-+++--+-----+++-++/||\+-++--+-+++-+++++++-++-+-+-++++++-+++++++-++++-+-++++-+++++-/
 || | |||| | ||  | |||  | || |     ||| |||  /+-+++++++-+-----\| | | |||  |     ||| || ||/+-++--+-+++-+++++++-++-+\| |||||| ||||||| |||| | |||| |||||
 || | |||| | ||  | |||  | || |     ||| |||  || ||||||| |     || | | |||  |     |\+-++-++++-++--+-+++-+++++++-++-+++-++++++-+++++++-++++-+-/||| |||||
 || | |||| | |\--+-+++--+-++-+-----+++-+++--++-+++++++-+-----++-+-+-+++--+-----+-+-++-++++-++--+-/|| ||||||| || ||| |||||| ||||||| |||| |  ||| |||||
 || | |||| | |   | |||  | || |     ||| |||  || ||\++++-+-----++-+-+-+++--+-----+-+-++-++++-++--+--++-+++++++-++-+++-++/||| ||||||| |||| |  ||| |||||
 || | |||| | |   | |||  | || |/----+++-+++\ || || |||| |     || | | |||  |     | | || |||| ||  |  || |||||\+-++-+++-++-+++-++++/|| |||| |  ||| |||||
 || |/++++-+-+---+-+++--+-++-++----+++-++++-++-++-++++-+-----++-+-+-+++--+-\   | | || \+++-++<-+--++-+/||| | || ||| || ||| |||| || |||| |  ||| |||||
 || |||||| | |   | |||  | || ||    ||| |||| || || |||| |     || | | |||  | |   | | ||  ||| ||  |  || | ||| | || ||| || ||| |||| || |||| |  ||| |||||
 || |||||| | |   | |||  | |\-++----+++-++++-++-++-++++-+-----++-+-+-+++--+-+---+-+-++--+++-++--+--++-+-+++-+-++-+++-++-+++-++++-+/ |||| |  ||| |||||
 || ||||||/+-+---+-+++\ | |  ||  /-+++-++++-++-++-++++-+----\|| | | |||  | |   | | ||  ||| ||  |  || | ||| | || ||| || ||| |||| |  |||| |  ||| |||||
 || |||||||| |   | |||| | |  ||  | ||| |||| |\-++-++++-+----+++-+-+-+++--+-+---+-+-++--+++-++--+--++-+-+++-+-++-+++-++-/|| |||| |  |||| |  ||| |||||
 || |||||||| |   | |||| | |  ||  | ||| |||| |  || \+++-+----+++-+-+-+++--+-+---+-+-++--+++-++--+--++-+-+++-+-++-+++-+/  || |||| |  |||| |  ||| |||||
 || |||||||| |   | |||| | |  ||  | ||| |||| |  ||  ||| |/---+++-+<+\|||  | |   |/+-++--+++-++--+--++-+-+++-+-++-+++-+-\ || |||| |  |||| |  ||| |||||
 || |||||||| |   | |||| | |  ||  | ||| |||| |  ||  ||| ||   ||| | |||||  | |   ||| ||  ||| ||  |  || | ||| | || ||| | | || |||| |  |||| |  ||| |||||
 || |||||||| |   | |||| | |  ||  | ||| |||| |  ||  ||| ||   ||| | |||||  | |   ||| ||  ||| ||  |  || | ||| \-++-+++-+-+-++-++++-+--++++-+--+/| |||||
 || \+++++++-+---+-++++-+-+--++--+-+++-++++-+--++--/|| ||   ||| | |||||  | |   ||| ||  \++-++--+--++-+-+++---++-+++-+-+-++-/||| | /++++-+--+-+-+++++-\
 ||  ||||||| |   | |||| | |  ||  | ||| |\++-+--++---++-++---+++-+-+++++--+-+---+++-++---++-++--+--++-+-+++---+/ ||| | | ||  ||| | ||||| |  | | ||||| |
 ||  |||||||/+---+-++++-+-+--++--+-+++-+-++-+--++---++-++---+++-+-+++++--+-+---+++-++---++-++-\|  || | |||   |  ||| | | ||  ||| | ||||| |  | | ||||| |
 ||  |||||||||   | |||| | |  ||  | ||| | || |  ||   ^| || /-+++-+-+++++--+-+-\ ||| ||   || || ||  || | ||| /-+--+++-+-+-++--+++-+-+++++-+-\| | ||||| |
 ||  |||||||||   | |||| | |  ||  | ||| | || |  ||   || || | ||| | |||||  | | | ||| ||   || || ||  || | ||| | |  ||| | | ||  ||| | ||||| | || | ||||| |
 ||  ||\++++++---/ |||| | |  ||  | ||| | || |  ||   || || | ||| \-+++++--+-+-+-+++-++---++-++-++--++-+-+++-+-+--++/ | | ||  ||| | ||||| | || | ||v|| |
 ||  || ||||||     ||\+-+-+--++--+-+++-+-++-+--++---++-++-+-+++---+++++--+-+-+-+++-++---++-++-++--++-+-++/ | |  ||  | | ||  ||| | ||||| | || | ||||| |
 ||  || ||||||     || | | |  ||  | ||| | || |  ||   || |\-+-+++---+/|||  | | | ||| |\---++-++-++--++-+-++--+-+--++--+-+-++--/|| | ||||| | || | ||||| |
 ||  || ||||||     || | | |  ||  | ||| | || | /++---++-+--+-+++---+-+++--+-+-+-+++\|    || || ||  || | ||  | |  ||  | | ||   || | ||||| | || | ||||| |
 ||  || ||||||     || | | |  ||  | ||| | || | |||   || |  | |||   | |\+--+-+-+-/||||    || || ||  || | ||  | \--++--+-+-++---++-+-+++++-+-++-+-+/||| |
 ||  \+-++++++-----++-+-+-+--++--+-+++-+-++-+-+++---++-+--+-+++---+-+-+--+-/ |  ||||    || || ||  || | ||  |    ||  | | ||   || | ||||| | || | | ||| |
 ||   | ||||||     || | | |  ||  | ||| | || | |||   || |  | |||   | | |  |   |  ||||    \+-++-++--++-+-++--+----+/  | | ||   || | ||||| | || | | ||| |
 ||   | ||||||     || | | |  ||  | ||| | || | |||   || |  | ||\---+-+-+--+---+--++++-----+-++-++--++-+-++--+----+---+-+-++---++-+-++/|| | || | | ||| |
 ||   \-++++++-----/| | | |  ||  | ||| | || | |||   || |  | ||    | | |  |   |  ||||     | || ||  || | ||  |    |   | | |\---++-+-++-++-+-+/ | | ||| |
 ||     ||||||      | | | |  ||  | ||| | || | |||   || |  | ||    | | |  |   |  ||||     | || ||  || | ||  |    |   | | |    || | || || | |  | | ||| |
/++-----++++++------+-+-+-+--++--+-+++-+-++-+-+++---++-+--+\||    | | |  |   |  ||||     | || ||  || | ||  |    |   | | |    || | || || | |  | | ||| |
|||     ||||||      | | | |  ||  | ||| \-++-+-+++---++-+--++++----+-+-+--+---+--++++-----+-+/ ||  || | ||  |    |   | | |    || | || || | |  | | ||| |
|||     ||||||      | | | |  || /+-+++---++-+-+++---++-+--++++---\| | |  |   |  ||||     | |  ||  |\-+-++--+----+---+-+-+----++-+-++-++-+-+--/ | ||| |
|||   /-++++++------+-+-+-+-\|| || |||   || | |||   || |  ||||   || | |  |   |  |||\-----+-+--++--/  | ||  |    |   | | |    || | || || | |    | ||| |
|||   | ||||||      | | | | ||| || |||   \+-+-+++---++-+--++++---++-+-+--+---+--+++------+-+--++-----+-++--+<---+---+-+-+----++-+-++-++-/ |    | ||| |
|||   | ||||||      | | | | ||| || |||    | | |||   || |  ||||   || | |  \---+--+++------+-+--++-----+-++--+----+---+-+-+----++-+-++-+/   |    | ||| |
|||   | ||||||      | | | \-+++-++-+++----+-+-+++---++-+--++++---++-+-+------+--+/|      | |  ||     | \+--+----+---+-+-+----++-+-++-/    |    | ||| |
|||   | ||||||      | | |   ||\-++-+++----/ | |||   |\-+--++++---++-+-+------+--+-+------+-+--++-----+--+--+---<+---+-+-+----++-+-++------+----+-++/ |
|||   | ||||||      | | |   ||  || \++------+-+++---+--+--++++---++-+-+------+--+-+------+-+--++-----+--+--+----+---+-+-+----++-+-+/      |    | ||  |
|||   | ||||||      | | |   ||  ||  ||      \-+++---+--+--+++/   ||/+-+------+--+-+------+-+--++-\   |  |  |    |   | | |    || | |       |    | ||  |
|||   | ||||\+------+-+-+---++--++--++--------+++---+--+--+++----++++-+------+--+-+------+-+--/| |   |  |  |    |   | | |    || | |       |    | ||  |
|||   | ||\+-+------+-/ |   |\--++--++--------+++---+--+--+++----++++-+------+--+-+------+-/   | |   |  |  |    |   | | |    || | |       |    | ||  |
|||   | \+-+-+------+---+---+---++--++--------+++---+--+--+++----++++-+------+--+-+------/     | |   |  |  |    \---+-+-+----++-+-+-------+----+-/|  |
|||   |  | | |      |   |   |   ||  ||        |||   |  |  \++----++++-+------/  | |            | |   |  \--+--------+-+-+----/| | |       |    |  |  |
|\+---+--+-+-+------/   |   |   \+--++--------+++---+--+---++----/||| |         | |            | |   |     \--------+-+-+-----+-+-+-------/    |  |  |
| |   |  | \-+----------+---+----+--/|        |||   |  |   ||     ||| |         | |            | |   |              | | |     | | |            |  |  |
| |   |  |   |          \---+----+---+--------+++---+--+---++-----+++-+---------+-+------------/ |   |              | | |     | | |            |  |  |
| \---+--+---/              |    |   |        ||\---+--+---++-----+++-+---------+-+--------------+---+--------------/ | |     \-+-+------------/  |  |
|     |  |                  |    |   \--------++----+--+---++-----+++-/         \-+--------------+---+----------------/ |       | |               |  |
|     |  |                  |    \------------++----+--+---+/     |\+-------------+--------------/   |                  |       | |               |  |
\-----+--+------------------+-----------------++----+--+---/      \-+-------------+------------------+------------------/       | |               |  |
      |  \------------------+-----------------++----/  |            |             |                  |                          | \---------------+--/
      |                     |                 ||       |            \-------------+------------------/                          |                 |
      |                     |                 ||       \--------------------------+---------------------------------------------/                 |
      |                     |                 |\----------------------------------+---------------------------------------------------------------/
      \---------------------/                 \-----------------------------------/                                                                   ";
    }
}